<?xml version="1.0" encoding="UTF-8"?>

<beans:beans xmlns="http://www.springframework.org/schema/security"
	xmlns:beans="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
						http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-3.1.xsd">

<!-- http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-3.1.1.xsd -->
	<!-- 
	<global-method-security secured-annotations="enabled" jsr250-annotations="enabled" pre-post-annotations="enabled">
		<protect-pointcut expression="execution(* com.mycompany.*Service.*(..))" access="ROLE_USER"/>
	</global-method-security>
	-->
	
	<http pattern="/css/**" security="none"/>
	<http pattern="/image/**" security="none"/>
	<http pattern="/javascript/**" security="none"/>
	<!-- <http pattern="/account/toIndex.action" security="none"/> -->
	<http pattern="/~*" security="none" />
	<http auto-config="true" use-expressions="true" access-denied-page="/jsp/403.jsp" >
		<!-- 登录退出URL -->
		<form-login	login-processing-url="/account/login.action"
					login-page="/account/login.action"
					authentication-failure-url="/account/login.action"
					default-target-url="/account/login.action"
					always-use-default-target="true" />
		<logout logout-url="/account/logout.action" logout-success-url="/account/toIndex.action"/>
		<!-- 自定义过滤器 -->
		<custom-filter before="FORM_LOGIN_FILTER" ref="myAuthenticationFilter"/>
	</http>  
	


	<beans:bean id="myAuthenticationFilter" class="eoas.tool.security.MyAuthenticationFilter">
		<beans:property name="myAuthentication" ref="myAuthentication"/>
	</beans:bean>
	
	<beans:bean id="myAuthentication" class="eoas.tool.security.MyAuthentication">
		<beans:property name="accountService" ref="accountService"/>
	</beans:bean>
	
	<authentication-manager alias="authenticationManager">
		<authentication-provider user-service-ref="myAccountDetailsService">
			<password-encoder hash="md5"/>
		</authentication-provider>
	</authentication-manager>

	<beans:bean id="myAccountDetailsService" class="eoas.tool.security.MyAccountDeitailsService">
		<beans:property name="accountService" ref="accountService"/>
	</beans:bean>
</beans:beans>